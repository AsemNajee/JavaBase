# JavaBase

بسم الله الرحمن الرحيم والصلاة والسلام على اشرف المرسلين .

اليوم اقدم لكم مكتبة تحاكي تقنية `ORM` للاتصال بقاعدة  البيانات من لغة جافا الى اي قاعدة بيانات بشكل تلقائي بدون الاهتمام بتفاصيل الاستعلامات .

<b>ملاحظة</b> : حالياً لم اقم باضافة استعلامات للتواصل مع كل انواع قواعد البيانات وانما فقط مع  `MYSQL` , `sqlite`  ، لكن يمكنك فعل ذلك من الحزمة المخصصة `javabase.core.database.querybuilders` .


هذه المكتبة هي مقتبسة من فكرة ال ORM في اطار العمل الشهير Laravel وقد حاولت سابقاً ان ابني شئ مشابه ستجده في مستودع JDBCLibrary .

## التثبيت 

انشئ مجلد جديد في حاسوبك ثم استعمل الامر التالي لتحميل المكتبة

```
git clone https://github.com/AsemNajee/JavaBase
```

ثم اضف مكتبة jdbc الى مشروعك للربط ...

مبروك عليك تم تثبيت المكتبة ويمكنك بدء العمل عليها والاتصال بقاعدة البيانات بدون مشاكل .

## البدء

بعد ان تضيف مكتبة الاتصال بقاعدة البيانات `jdbc` قم بتشغيل ملف `DevHandler` واكتب الاتي :

- اذا كنت تستعمل `sqlite` كل ما عليك فعله هو كتابة الامر `db:migrate` وسيتم انشاء الجداول تلقائياً
- اذا كنت تستعمل قاعدة بيانات `mysql` اكتب الاوامر الاتية `db:init` لانشاء قاعدة بيانات ثم `db:migrate` لانشاء الجداول

ملاحظة : ان كنت تريد تسريع العملية على نفسك في اختبار المكتبة استعمل `sqlite` وهي الاعداد الافتراضي ويلزمك `jdbc` خاصتها ويمكنك تغيير هذا الاعداد من ملف `ENV` 

## البدء في العمل 

بعد نسخ المستودع الى حاسوبك وتثبيت قاعدة البيانات واضافة مكتبة الاتصال الى المحرر ، الان تستطيع البدء بالعمل .

افتح الملف `Handler` وقم بتشغيله ، هذا هو نقطة البداية لمشروعك ، لا تقم بالتعديل على هذا الملف كي لا تظهر لك مشاكل ان كنت لا تعرف مالذي تفعله .

بما اننا عرفنا ان نقطة البدء هي `Handler` تبقى الان معرفه اين سيتم كتابة البرنامج ، وايضاً يوجد ملف باسم `Main` قم بكتابه برنامجك بداخله .

افتح ملف `DevHandler` وقم بتشغيله ، هذا الملف هو مساعدك الخاص لتسريع عملية التطوير .

## انشاء الجداول 

يوجد جداول معدة مسبقاً تجدهم في `database.models` واي جدول ستقوم باضافته تالياً سيتم انشائه في هذه الحزمة

ايضاً من ملف `DevHandler` استعمل الامر التالي لانشاء فئة جديدة

```
make:model Animal
```

سيتم انشاء ملف جديد في الحزمة `database.models` باسم `Animal` قم بعمل خصائص فيها مثل `age` واعد تشغيل ملف `DevHandler` واستعمل الامر التالي لتحويل الفئة الى جدول في قاعدة البيانات

```
db:migrate Animal
```

ملاحظة : يتم اعتماد الخصائص النصية وذات انواع البيانات العادي ولا يتم اعتماد الكائنات الاخرى ، كما يتم اعتماد الخصائص ذات محددات الوصول `private` , `protected` فقط .

اذا كنت تريد انشاء جداول لكل الفئات استعمل

```
db:migrate
```

قبل اي امر عليك ان تنشئ قاعدة البيانات اولاً والتي يمكنك تحديد اسمها في ملف ```ENV``` وانشئها في مدير قواعد البيانات باستخدام الامر :

اكتب الامر ```help``` لاستعراض كل الاوامر

---

## الية العمل

سنشرح طريقة انشاء فئة تتحول الى جدول ولكن بدون استعمال ملف `DevHandler`

لكي تبدا باستخدام المكتبة عليك اولاً ان تنشئ فئة جديدة ترث من الفئة ```Model``` ، سنضرب مثالاُ باستخدام فئة ```User``` كالتالي :

~~~ java
public class User extends Model<User>{
    protected int id;
}
~~~

<b>ملاحطة</b> : يجب ان يتم انشاء الفئة ```User``` في الحزمة ```database.models``` .

المثال يوضح بساطة انشاء مودل جديد ولك كامل الحرية في اضافة المزيد من الخصائص والدوال ، لكن عليك ان تنتبه ان تكون الخصائص التي تريد ان يتم تخزينها في قاعدة البيانات لها محدد وصول <u> protected</u> او private

كما من الضروري ان تحدد النوع العام للمودل الاب ويكون المودل الابن كما في ```Model<User>``` .

تهانينا الان اصبحت الفئة User قادرة على الاتصال بقاعدة البيانات .

---

## القيود 

يمكنك تخصيص القيود على الاعمدة باستخدام الملاحظات Annotations كما في ```@PrimaryKey("id")``` و ```@Unique``` .

|     القيد      |                         وظيفته                         |                                   مثال                                   |
|:--------------:|:------------------------------------------------------:|:------------------------------------------------------------------------:|
|    @Unique     |               جعل العمود في الجدول فريد                |                                                                          |
|    @NotNull    |       جعل العمود في الجدول لا يقبل القيم الفارغة       |                                                                          |
|    @Default    | جعل العمود يستعمل قيمة افتراضية اذا تم اسناد Null اليه |                                                                          |
| @AutoIncrement |   جعل المفتاح الرئيسي ان كان رقمي يزداد بشكل تلقائي    |                                                                          |
|  @ForeignKey   |             جعل الحق مفتاح اجنبي لجدول اخر             | @ForeignKey(Person.class) \|\| @ForeignKey(value=Person.class, key="id") |
|  @PrimaryKey   |         اضفه على الفئة لتحديد مفتاحها الرئيسي          |                            @PrimaryKey("id")                             |


---

## حفظ البيانات وجلبها من قاعدة البيانات

اذا اردت ادخال بيانات الى قاعدة البيانات يمكنك انشاء كائن ثم استدعا الدالة ```save()``` منه كالتالي : 

```java
public class Main{
    public static void main(String[] args) {
        Person person = new Person(1, "Asem");
        person.save();
    }
}
```

تم حفظ البيانات في قاعدة البيانات .

استعمل الدالة ```find(Object key)``` او ```getAll()``` لجلب البيانات من قاعدة البيانات : 

```java
public class Main{
    public static void main(String[] args) {
        Person person = new Person();
        person = person.find(1);
    }
}
```

الدالة ```find``` تقوم بجلب البيانات من القاعدة وتقوم بارجاع كائن مليئ بالبيانات كما في المثال خزنا قيمته في person نفسه ولاحظ ان انشاء الكائن هو فقط لكي نستطيع استخدام الدالة ```find``` ويمكن استبدال الامر السابق بالتالي : 

```java 
public class Main {
    public static void main(String[] args) {
        Person person = Model.of(Person.class).find(1);
    }
}
```

او :

```java
public class Main {
    public static void main(String[] args) {
        person = Model.find(Person.class, 1);
    }
}
```

افتراضياً اذا حاولت طباعة الكائن المرتبط بقاعدة البيانات سيتم طباعته بتنسيق `json`

```
Command.println(person);
```

والمخرجات ستكون :

```json
{
   "id" : 1,
   "name" : "Asem"
}
```

---

## باني الاستعلامات 

من افضل الميزات في المشروع انك تستطيع عمل استعلامات على قاعدة البيانات بشكل سهل جداً ، لاحظ استعلام من جدول `person` الذي تم انشاءه من الفئة `Person`

```java
import javabaseproject.database.models.Person;
import javabaseproject.database.models.User;
import javabaseproject.javabase.core.database.querybuilders.query.Condition;
import javabaseproject.javabase.core.database.querybuilders.query.DB;

public class Main {
    public static void main(String[] args) {
//        all rows
        DB.from(Person.class).all();
//        first row
        DB.from(Person.class).get();
//        first row with id = 1
        DB.from(Person.class).where("id", 1).get();
//        rows with id's in 1,2,3
        DB.from(Person.class).whereIn("id", 1, 2, 3).get();
//        joins
        DB.from(Person.class).innerJoin(User.class, Condition.on("person.userId", "user.id")).all();
    }
}
```

---

## مرجع شامل للدوال التي يمكنك استعمالها في الفئات المتصلة بقاعدة البيانات 

| اسم الدالة  | وظيفتها                                                                                                    |
|-------------|------------------------------------------------------------------------------------------------------------|
| `save()`    | حفظ بيانات الكائن في قاعدة البيانات ان كان الكائن جديد او تحديث بياناته ان كان تم جلبه من قاعدة البيانات   |
| `delete()`  | حذف البيانات من قاعدة البيانات اعتماداً على قيمة محتوى المفتاح الرئيسي                                     |
| `find(key)` | جلب البيانات من قاعدة البيانات اعتماداً على المفتاح الرئيسي الذي تم تحديده في الفئة باستخدام @PrimaryKey() |
| `getAll()`  | جلب كل الحقول المخزنة في القاعدة وتعيد ```ArrayList``` تحتوي على كائنات من من نفس نوع الفئة التي استدعتها  |
| `factory()` | جلب كائن من كلاس المصنع ، هذا الكلاس يمكنك انشائه باستخدام الامر `make:factory Person`                     |
| `seeder()`  | جلب كائن من كلاس البذر ، هذا الكلاس يمكنك انشائه باستخدام الامر `make:seeder Person`                       |
| `query()`   | جلب باني استعلام لعمل استعلامات على جدول قاعدة البيانات                                                    |
| `getKey()`  | جلب قيمة المفتاح الرئيسي مهما كان اسمه ونوع بياناته                                                        |


## مصانع البيانات

مصانع البيانات تساعدك في انشاء كائنات بقيم عشوائية من الفئة ```Faker``` .

<b>ملاحظة : </b> يمكن دعم تعدد اللغات في انشاء قيم عشوائية وذلك من فئة ```javabase.lang.FakeData``` .

استعمل الامر التالي لانشاء مصنع وباذر للفئة ```Perosn``` :

```
make:factory Person
```

الامر السابق لن يكتفي فقط بانشاء المصنع  فقط وانما سينشئ منشئ جديد في الفئة ```Person``` يحتوي على وسائط لكل الخصائص التي يمكن ادخال بيانات اليها لكي يتم استدعائه في الصانع .

دعنا نطبق المثال اضف ```protected String email;``` الى الفئة ```Person``` ثم نفذ امر انشاء المصنع

ستجد انه تم اضافة constructor الى ```Person``` :

```java
import javabaseproject.javabase.core.database.models.Model;

public class Person extends Model<Person>{
    public Person(String name, int id, String email) {
        this.name = name;
        this.id = id;
        this.email = email;
    }
}

```

وتم اضافة ملف جديد في ```database.factories``` باسم ```PersonFactory``` ويحتوي على :

~~~java
public class PersonFactory extends Factory<Person>{
    public Person item() {
        return new Person(
   Fake.name(),
   Fake.randomNumber(),
   Fake.email()
        );
    }
}
~~~

يمكنك تخصيصه كما تشاء .

لاحظ اننا نستعمل فئة ```Fake``` للحصول على قيم عشوائية ولكنها ليست فريدة لذا غالباً ما تظهر اخطاء عندما نقوم ببذر العديد من الصفوف بسبب جلب اسماء عشوائية وليست فريدة .

## البذور

استعمل الامر

~~~
make:seeder Person
~~~

وستحصل على باذر بيانات للفئة ```Person``` في ```database.seeders``` باسم ```PersonSeeder``` وتحتوي على :

~~~java
public class PersonSeeder extends Seeder {
    public void run() throws Exception{
        Model.of(Person.class).factory().create(10);
    }
}
~~~

الان استعمل الامر

~~~
start:seeder Person
~~~

وستحصل على 10 صفوف عشوائية البيانات في قاعدة البيانات جرب جلبها باستعمال الدالة ```getAll()``` :

~~~java
public class Main{
    public static void main(String[] args) {
        Command.println(Model.of(User.class).getAll());
    }
}
~~~

ستحصل عليهم وسيتم طباعتهم بتنسيق `json`

## الطباعة

لاحظ اننا نستعمل ```Command.println``` للطباعة وهذا يجعلك تلون المخرجات كما تريد كالتالي :

~~~java
public class Main {
    public static void main(String[] args) {
        Command.println("r{Hello}, World");
    }
}
~~~

سيتم طباعة الكلمة ```Hello```  باللون الاحمر ، انظر الجدول التالي :

| اللون  | لون النص | لون الخلفية |
|--------|----------|-------------|
| احمر   | r{text}  | r[text]     |
| اخضر   | g{text}  | g[text]     |
| اصفر   | y{text}  | y[text]     |
| ازرق   | b{text}  | b[text]     |
| بنفسحي | p{text}  | p[text]     |
| اسود   | k{text}  | k[text]     |
| ابيض   | w{text}  | w[text]     |

<b>ملاحظة : </b> لا يمكن عمل تلوين متداخل .

## خاتمة

ختاما لم استطيع ان اشرح كل التفاصيل حاول اكتشافها بنفسك ، كما ان المكتبة مليئة بالاخطا لكنها تفي بالغرض .

ولا تنسى الصلاة على النبي
